<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} | Patrick Ellis</title>
    <style>
        :root { --explorer-width: 300px; --border-color: #e5e7eb; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; margin: 0; background: #f9fafb; color: #111827; display: flex; height: 100vh; }
        a { color: #007ec6; text-decoration: none; }
        h1, h2, h3 { line-height: 1.2; }
        pre { background: #f3f4f6; padding: 1em; overflow-x: auto; border-radius: 6px; }
        code { font-family: monospace; }
        .latex-block { cursor: pointer; padding: 1em; border: 1px dashed #d1d5db; margin: 1em 0; border-radius: 6px; }
        .latex-source { background: #e5e7eb; padding: 0.5em; margin-top: 0.5em; font-family: monospace; font-size: 0.9em; display: none; border-radius: 4px; }
        
        /* New Layout Styles */
        #explorer { width: var(--explorer-width); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; background: #fff; height: 100vh; }
        #explorer-header { padding: 1rem; border-bottom: 1px solid var(--border-color); }
        #explorer-header input { width: 100%; box-sizing: border-box; padding: 0.5em; border: 1px solid var(--border-color); border-radius: 4px; }
        #post-list-container { flex-grow: 1; overflow-y: auto; padding: 1rem; }
        #post-list-container ul { list-style: none; padding: 0; margin: 0; }
        #post-list-container li a { display: block; padding: 0.25rem 0.5rem; border-radius: 4px; }
        #post-list-container li a:hover { background-color: #f3f4f6; }
        
        #content-wrapper { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; }
        #content-nav { padding: 0 2rem; border-bottom: 1px solid var(--border-color); background-color: #fff; }
        #content-nav ul { display: flex; list-style: none; margin: 0; padding: 0; }
        #content-nav a { display: block; padding: 1rem 1.5rem; border-bottom: 2px solid transparent; }
        #content-nav a.active { border-bottom-color: #007ec6; font-weight: 600; }
        
        #content-pane { flex-grow: 1; overflow-y: auto; padding: 2rem; max-width: 800px; }
        
        footer { padding: 2rem; border-top: 1px solid var(--border-color); color: #6b7280; font-size: 0.9em; }
    </style>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}] });"></script>
</head>
<body>
    <!-- Left Column: Explorer -->
    <aside id="explorer">
        <div id="explorer-header">
            <h3>Posts</h3>
            <input 
                type="search" name="q" placeholder="Search posts..."
                hx-post="/search" hx-trigger="keyup changed delay:300ms, search"
                hx-target="#post-list" hx-indicator="#search-indicator">
            <span id="search-indicator" class="htmx-indicator">...</span>
        </div>
        <div id="post-list-container">
            <div id="post-list">
                {{template "search-results.html" .}}
            </div>
        </div>
    </aside>

    <!-- Right Column: Content -->
    <div id="content-wrapper">
        <nav id="content-nav">
            <ul>
                <li><a href="/" hx-get="/" hx-target="#content-pane" hx-push-url="true" class="{{if eq .PageID "home"}}active{{end}}">Home</a></li>
                <li><a href="/about" hx-get="/about" hx-target="#content-pane" hx-push-url="true" class="{{if eq .PageID "about"}}active{{end}}">About Me</a></li>
            </ul>
        </nav>
        <main id="content-pane">
            {{if eq .PageID "home"}}{{template "home.html" .}}{{end}}
            {{if eq .PageID "about"}}{{template "about.html" .}}{{end}}
            {{if eq .PageID "post"}}{{template "post-content.html" .Content}}{{end}}
        </main>
        <footer>
            <p>&copy; 2025 Patrick Ellis</p>
            <p>Site Performance: <img src="/metrics-badge" alt="Performance Metrics"></p>
        </footer>
    </div>

    <script>
        // Re-render LaTeX when htmx swaps content
        document.body.addEventListener('htmx:afterSwap', function(event) {
            renderMathInElement(event.detail.target, {delimiters: [{left: '$$', right: '$$', display: true}] });
        });
        // Click-to-reveal logic
        document.body.addEventListener('click', function(event) {
            if (event.target.classList.contains('latex-block')) {
                let sourceDiv = event.target.querySelector('.latex-source');
                if (!sourceDiv) {
                    sourceDiv = document.createElement('div');
                    sourceDiv.className = 'latex-source';
                    sourceDiv.textContent = event.target.getAttribute('data-source');
                    event.target.appendChild(sourceDiv);
                }
                sourceDiv.style.display = sourceDiv.style.display === 'block' ? 'none' : 'block';
            }
        });
    </script>
</body>
</html>
