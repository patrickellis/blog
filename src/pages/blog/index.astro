---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);

function getReadingTime(content) {
  const wordsPerMinute = 200;
  const wordCount = content.split(/\s+/).length;
  const time = Math.ceil(wordCount / wordsPerMinute);
  return `${time} min read`;
}
---

<!doctype html>
<html lang="en">
<head>
	<BaseHead title="Stories" description="All my articles" />
</head>
<body>
	<Header />
	<main>
		<h1>Stories</h1>
		<ul>
			{posts.map((post) => {
				// Get the category, make it lowercase for the CSS class, or use 'default'
				const categoryClass = (post.data.category || 'default').toLowerCase();
				const readingTime = getReadingTime(post.body);

				return (
					<li class="post-list-item">
						<a href={`/blog/${post.slug}/`}>
							<!-- Category Tag -->
							<div class={`category-tag ${categoryClass}`}>
								{post.data.category || 'General'}
							</div>

							<!-- Post Title -->
							<h2 class="post-title">
								{post.data.title}
							</h2>

							<!-- Post Description -->
							<p class="post-description">
								{post.data.description}
							</p>

							<!-- Metadata: Date and Reading Time -->
							<div class="post-meta">
								<FormattedDate date={post.data.pubDate} />
								<span class="mx-1">Â·</span>
								<span>{readingTime}</span>
							</div>
						</a>
					</li>
				);
			})}
		</ul>
	</main>
	<Footer />
</body>
</html>
